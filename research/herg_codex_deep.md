# hERG Toxicity Formal Verification (Codex Deep Dive)

## 1. Scientific Summary (≈200 words)
hERG (KCNH2) forms an unusually promiscuous inner vestibule: a 13 Å wide aromatic cage plus acidic lining that attracts any flexible, lipophilic, protonated small molecule. Binding is hard to predict because the open channel tolerates many poses, state-dependent gating reshapes the pocket, and solvation penalties vary with membrane voltage. Cryo-EM structures (PDB: 5VA1, 7CN1) exist but have 3.0–3.5 Å resolution and static conformations, so MD-only explanations rarely transfer. Empirically, most hERG binders share a triad: (1) a cationic center (pKa > 7) accessible under physiological pH, (2) at least one aromatic ring that can π-stack with Tyr652/Phe656, and (3) a hydrophobic tail that reaches the base of the pore. Yet many false negatives appear because those motifs can contort, and protonation state plus lipophilicity are context-dependent. Datasets are abundant (ChEMBL, FDA labels, AstraZeneca in-house lists, CiPA IC50 tables) but noisy: assays differ (patch clamp vs fluorescence), and IC50 spans 6 orders of magnitude. Industry therefore relies on black-box QSAR or docking heuristics with ~70% precision, still too low for Phase III. To convince pharma, we must prove necessity: certify that a candidate *lacks* the minimal pharmacophore geometry required for hERG block under any tautomeric/protonation state.

## 2. Formal Approach (≈300 words)
The simplest impossibility proof is discrete and pharmacophore-based: if all validated hERG binders require a {cationic center, aromatic plane, hydrophobic tail} motif with bounded distances, proving any candidate molecule cannot instantiate that motif suffices. We avoid thermodynamics and continuum electrostatics entirely; we work with coarse geometry extracted from a single Cryo-EM snapshot and empirical spacing constraints from literature (e.g., 4.5±0.5 Å between cation and aromatic centroid; ≥6 Å between aromatic and hydrophobic tail). The workflow:

1. Pre-compute, outside Lean, a finite set of pharmacophoric features for the candidate (possible protonation sites, aromatic centroids, hydrophobic scaffolds) plus all pairwise distances following IUPAC conventions. Extraction can use RDKit, but Lean only consumes a file of rational coordinates/distances and verified bounds.

2. Encode, in Lean, the necessary-condition theorem: if a molecule binds hERG, there exists a triple of features satisfying concrete algebraic inequalities (distance windows, charge predicates). The theorem reduces to combinatorial search over a finite feature set plus linear inequalities in ℚ or ℝ.

3. Provide, as hypotheses, the exhaustive feature list for the candidate and proofs that (a) no feature is protonatable at pH 7 (if relevant) or (b) distance windows fail. Each hypothesis is a simple inequality such as "dist cation aromatic ≥ 5.2".

4. Lean runs a case split over the finite feature combos and discharges inequalities with `linarith`/`nlinarith` (already in mathlib). No continuous optimization, no docking, just arithmetic reasoning.

This approach is simplest because: (i) discretized features mean the search space is finite and small (~tens of combinations); (ii) inequalities are rational, so algebraic tactics are robust; (iii) necessary-condition theorem is reusable—once proven, new molecules only need data instantiations, not new math. The heavy chemistry heuristics (feature extraction, protonation analysis) stay outside Lean but supply traceable certificates (JSON of features + proofs) that Lean checks. Thus, impossibility reduces to certifying absence of a specific motif.

## 3. Lean Formalization Sketch
```lean
structure Feature where
  id : String
  kind : FeatureKind -- Cationic | Aromatic | Hydrophobe
  coord : ℚ × ℚ × ℚ
  valid : Prop -- e.g., "protonated at pH 7"

structure Molecule where
  feats : Finset Feature

structure BindingCertificate where
  cation : Feature
  aromatic : Feature
  tail : Feature
  h1 : cation.kind = .Cationic ∧ cation.valid
  h2 : aromatic.kind = .Aromatic
  h3 : tail.kind = .Hydrophobe
  dist_ca : distance cation.coord aromatic.coord ∈ closedBall 4.0 0.6
  dist_at : distance aromatic.coord tail.coord ≥ 6.0

axiom necessary_motif
  (m : Molecule) : BindsHERG m → ∃ cert : BindingCertificate, cert.valid_for m

/-- Candidate data: encoded features and proven inequalities. -/
structure MoleculeFacts where
  mol : Molecule
  witnesses : ∀ cert, cert.valid_for mol → False

theorem candidate_safe (facts : MoleculeFacts) : ¬ BindsHERG facts.mol :=
by
  intro h
  obtain ⟨cert, hcert⟩ := necessary_motif facts.mol h
  exact facts.witnesses cert hcert
```

Feature extraction happens outside Lean; Lean receives `facts.witnesses` as a finite case analysis script generated by Aristotle.

## 4. Feasibility Assessment (≈100 words)
Aristotle already reasons over discrete math, finite cases, and linear inequalities. The only non-trivial Lean step is instantiating `necessary_motif`, which we prove once with human guidance. After that, each molecule reduces to enumerating a dozen feature triples; Aristotle can generate and verify the `witnesses` proof because it is just repeating `have : dist ≥ 5.2 := data`, `linarith`. The workflow is well within Lean 4's current automation. Hard parts (computing protonation and coordinates) stay outside Lean but yield certified rationals. Thus, Aristotle can realistically discharge candidate-specific proofs in minutes once the template exists.

## 5. MVP Definition (≈100 words)
A pharma-credible MVP is a Lean proof that "Drug X cannot satisfy the canonical hERG pharmacophore under any biologically relevant protonation." Deliverables: (1) a literature-backed theorem `necessary_motif`, citing empirical constraints; (2) a Lean proof file ingesting a single high-value clinical candidate's feature certificate and concluding `¬ BindsHERG DrugX`; (3) a PDF/HTML report exporting the formal proof statement and linking to the dataset used to derive the constraints. This gives deterministic, auditable assurance for one molecule—enough for medicinal chemists to treat it as a design green-light while we expand coverage later.

## 6. Implementation Plan (5 steps)
1. **Literature compression (3 days)**: extract numeric constraints for the minimal hERG pharmacophore from CiPA, FDA reports, Wang et al. 2017 (Cryo-EM), and AZ internal analyses; freeze them as intervals with provenance.

2. **Template theorem (4 days)**: formalize `necessary_motif` in Lean, referencing external constraints as axioms initially, then replace with lemmas backed by citations.

3. **Feature extraction pipeline (3 days)**: RDKit script enumerating candidate's protonation states, pharmacophore features, and rationalized coordinates; emit JSON + Lean declaration stubs.

4. **Certificate generator (2 days)**: Aristotle script that reads JSON, instantiates `MoleculeFacts`, and emits Lean proofs that every triple violates at least one constraint.

5. **Demo + validation (2 days)**: run Lean on a single clinical molecule, export the `candidate_safe` theorem, and cross-check with chemists for sanity before scaling.
